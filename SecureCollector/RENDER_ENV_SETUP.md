# 🔐 Render Environment Variables Setup

This guide explains how to configure environment variables in Render for your SecureCollector deployment.

## 📋 Required Environment Variables

### 1. Auto-Generated by Render
```bash
DATABASE_URL - PostgreSQL connection string (auto-generated when you connect database)
PORT - Server port (auto-set to 10000 by Render)
NODE_ENV - Set to "production" in render.yaml
```

### 2. Security Keys (You Must Generate)
```bash
ENCRYPTION_KEY=your-32-character-encryption-key-here
SESSION_SECRET=your-session-secret-key-for-jwt-tokens
```

## 🔑 Generate Security Keys

Run these commands locally to generate secure keys:

```bash
# Generate ENCRYPTION_KEY (32 characters)
node -e "console.log('ENCRYPTION_KEY=' + require('crypto').randomBytes(32).toString('hex'))"

# Generate SESSION_SECRET (64 characters)
node -e "console.log('SESSION_SECRET=' + require('crypto').randomBytes(64).toString('hex'))"
```

**Save these keys securely - you'll need them for Render!**

## 🚀 How to Set Environment Variables in Render

### Method 1: Render Dashboard (Recommended)

1. **Go to Your Service**
   - Login to https://dashboard.render.com
   - Select your SecureCollector service

2. **Navigate to Environment Variables**
   - Go to "Environment" tab
   - Click "Add Environment Variable"

3. **Add Required Variables**
   ```bash
   Key: ENCRYPTION_KEY
   Value: your-generated-32-character-key
   
   Key: SESSION_SECRET  
   Value: your-generated-64-character-key
   ```

### Method 2: render.yaml (for non-sensitive vars)

Already configured in `render.yaml`:
```yaml
envVars:
  - key: NODE_ENV
    value: production
  - key: PORT
    value: 10000
```

**⚠️ Never put sensitive keys in render.yaml - use the dashboard!**

## 🗄️ Database Setup (Automatic with Render)

### Option A: Render PostgreSQL (Recommended - Simplest)

1. **Database Auto-Creation**
   - Render will automatically create a PostgreSQL database
   - DATABASE_URL will be auto-generated and connected
   - No manual setup required!

2. **Database Details** (Auto-configured)
   - Name: `securecollector-db`
   - User: `securecollector_user` 
   - Plan: Free tier (500MB)

### Option B: External Database

If you prefer external database:

1. **Neon**: https://neon.tech
2. **Supabase**: https://supabase.com
3. **Railway**: https://railway.app

Then add manually:
```bash
Key: DATABASE_URL
Value: postgresql://user:pass@hostname:port/database
```

## 📦 Complete Environment Variables Checklist

### ✅ **Required Variables**
```bash
✅ DATABASE_URL - Auto-generated by Render (or manual if external)
✅ ENCRYPTION_KEY - Generate and add manually
✅ SESSION_SECRET - Generate and add manually
✅ NODE_ENV - Auto-set to "production"
✅ PORT - Auto-set to 10000
```

### ⚪ **Optional Variables** (for enhanced features)
```bash
⚪ SMTP_HOST - Email server hostname
⚪ SMTP_USER - Email username  
⚪ SMTP_PASS - Email password
⚪ CLOUDINARY_CLOUD_NAME - For image storage
⚪ CLOUDINARY_API_KEY - Cloudinary API key
⚪ CLOUDINARY_API_SECRET - Cloudinary API secret
```

## 🔄 Testing Your Configuration

After setting environment variables:

1. **Trigger Deployment**
   - Push to your connected Git repository
   - Render will automatically deploy

2. **Check Service Logs**
   - Go to Render dashboard → Your service → Logs
   - Look for successful startup messages

3. **Test Endpoints**
   ```bash
   # Test health check
   curl https://your-app.onrender.com/api/stats
   
   # Test authentication  
   curl -X POST https://your-app.onrender.com/api/auth/login \
     -H "Content-Type: application/json" \
     -d '{"username":"admin@seedofchrist.org","password":"5646"}'
   ```

## 🚨 Troubleshooting

### **Build Failures**
- Check Render build logs for specific errors
- Ensure all dependencies are in package.json
- Verify Node.js version compatibility

### **Database Connection Issues**
- Check DATABASE_URL is correctly set
- For external databases, ensure they're publicly accessible
- Test connection string locally first

### **Environment Variable Errors**
- Verify all required variables are set in dashboard
- Check for typos in variable names
- Ensure keys are the correct length

### **App Not Starting**
- Check service logs for startup errors
- Verify PORT environment variable (should be 10000)
- Ensure build process completed successfully

## 🎯 Render-Specific Advantages

### ✅ **Why Render is Great for SecureCollector**
- **Full-Stack Support**: Native Node.js + PostgreSQL
- **Auto Database**: Built-in PostgreSQL with free tier
- **Simple Deployment**: Direct from GitHub with auto-builds
- **Zero Configuration**: Works with existing Express server
- **Free Tier**: Perfect for church/non-profit use

### 🆚 **Render vs Netlify**
- ✅ **Better for full-stack**: No serverless conversion needed
- ✅ **Database included**: Built-in PostgreSQL 
- ✅ **Simpler setup**: Your existing code works as-is
- ✅ **Better for Node.js**: Native Express server support

## 📞 Need Help?

If you encounter issues:
1. Check Render service logs
2. Verify all environment variables are set
3. Test database connection
4. Review the deployment guide

Your SecureCollector app should now be ready to deploy on Render! 🎉
